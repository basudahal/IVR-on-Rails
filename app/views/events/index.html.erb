<script>
<![CDATA[
    function firstThree(btn) {
        var digits = btn.charAt(0);
        for (var i = 1; i < 3; i++) {
            digits += btn.charAt(i);
        }
        return digits;
    }
    function secondThree(btn) {
        var digits = btn.charAt(3);
        for (var i = 4; i < 6; i++) {
            digits += btn.charAt(i);
        }
        return digits;
    }
    function lastFour(btn) {
        var digits = btn.charAt(6);
        for (var i = 7; i < 10; i++) {
            digits += btn.charAt(i);
        }
        return digits;
    }
]]>
</script>
<var name="btn" />
<form id="GetBTN">          
    <field name="btnField">
        <property name="inputmodes" value="dtmf" />
			<grammar root="PHONEDIGITS" mode="dtmf">
				<rule id="PHONEDIGITS" scope="public">		
					<tag> $ = ""; </tag>
					<item repeat="10">
						<ruleref uri="#DIGIT"/>
						<tag> $ = $ + $$; </tag>
					</item>		
				</rule>
				
				<rule id="DIGIT">
				  <one-of>
					  <item> 0 <tag> $ = "0"; </tag> </item>
					  <item> 1 <tag> $ = "1"; </tag> </item>
					  <item> 2 <tag> $ = "2"; </tag> </item>
					  <item> 3 <tag> $ = "3"; </tag> </item>
					  <item> 4 <tag> $ = "4"; </tag> </item>
					  <item> 5 <tag> $ = "5"; </tag> </item>
					  <item> 6 <tag> $ = "6"; </tag> </item>
					  <item> 7 <tag> $ = "7"; </tag> </item>
					  <item> 8 <tag> $ = "8"; </tag> </item>
					  <item> 9 <tag> $ = "9"; </tag> </item>		  		 
				  </one-of>
			  </rule>
			</grammar>    
        <prompt>
             Starting with the area code, please enter the 10 digit phone number for your account. 
            <!--<audio src="@VoiceFiles.GetVoiceFilePath(Model, VoiceFiles.CustomerAccount._18000_EnterPhoneNumber)" />    -->         
        </prompt>                 
        <filled>
            <assign name="btn" expr="btnField"/>
            <goto next="#ConfirmBTN" />
        </filled>
    </field>
</form>
<form id="ConfirmBTN">        
    <field name="confirmField">          
        <prompt>        
             I heard:    
            <!--<audio src="@VoiceFiles.GetVoiceFilePath(Model, VoiceFiles.CustomerAccount._18050_ConfirmBTN_1)" /> -->                        
                <say-as interpret-as="digits">                       
                    <value expr="firstThree(btn)"/>
                </say-as>       
            <break />                    
                <say-as interpret-as="digits">                       
                    <value expr="secondThree(btn)"/>
                </say-as>      
            <break />                     
                <say-as interpret-as="digits">                       
                    <value expr="lastFour(btn)"/>
                </say-as>        
            <break />                        
             If that is the right phone number for your account, press 1.  Or, to give us a different phone number, press 2.        
            <!--<audio src="@VoiceFiles.GetVoiceFilePath(Model, VoiceFiles.CustomerAccount._18050_ConfirmBTN_2)" />-->                 
        </prompt>       
        <option dtmf="1" value="Yes"/>
        <option dtmf="2" value="No"/>                    
        <filled>
            <if cond="confirmField == 'No'">                                                                            
                <goto next="#GetBTN" />                               
            <else />
               <submit next="#mainmenu" namelist="btn"/>      
            </if>
        </filled>  
    </field>           
</form>
<form id="mainmenu">
	<block>
		<prompt>
			Your number is <say-as interpret-as="digits"><value expr="btn"/></say-as>. Welcome to Event Reservation System. 

			Currently there are <%= @events.size %> events.
		</prompt>
		<% @events.each do |event| %>
		<prompt>
			Event: <%= event.name %> in <%= event.location %> and the price for event is <%= number_to_currency(event.price) %>.
		</prompt>
		<% end %>
		<goto next="#GetBTN"/>
	</block>
</form>